<?php 
	require_once 'db.php'; // The mysql database connection script
	//$id="'".stripslashes($_REQUEST['id'])."'";
    $id=$_REQUEST['id'];
	$time=$_REQUEST['time'];
	$lat=$_REQUEST['lat'];
	$lon=$_REQUEST['lon']; //
	$destlat=$_REQUEST['destlat'];
	$destlon=$_REQUEST['destlon'];
    print($id);
    print("lat " + $lat);
    echo "lon " + $lon;
    print("\n");

	$url = "http://maps.googleapis.com/maps/api/directions/json?origin="  . $lat . "," . $lon . "&destination=" . $destlat . "," . $destlon . "&sensor=false&units=metric&mode=driving";

	//print($url); //URL working

	$jsondata = file_get_contents($url); //this is working too, I think...
	//print_r($jsondata);
	$routes = json_decode($jsondata);
	//print_r($routes);
	$encoded = (string) $routes->routes[0]->overview_polyline->points;
	//print($encoded); //OMG I GOT THE STRING

	    $string = $encoded;
        $points = array();
        $index = $i = 0;
        $previous = array(0,0);
        while ($i < strlen($string)) {
            $shift = $result = 0x00;
            do {
                $bit = ord(substr($string, $i++)) - 63;
                $result |= ($bit & 0x1f) << $shift;
                $shift += 5;
            } while ($bit >= 0x20);

            $diff = ($result & 1) ? ~($result >> 1) : ($result >> 1);
            $number = $previous[$index % 2] + $diff;
            $previous[$index % 2] = $number;
            $index++;
            $point = $number * 1 / pow(10, 5);
                #print($point . "*");
            $points[] = $point;
        }
        
        for($i = 0; $i < sizeof($points); $i += 2) {
            if(i>0){ $polyline .= "|"; }
            $polyline .= $points[$i] . "," . $points[$i+1]
        }



    $polyline = "'" . $polyline . "'";

    //print($polyline); //I THINK THIS WORKS!!!

    $eta=(string)$routes->routes[0]->legs[0]->duration->value;
    //print_r($eta);
    
    
    //$query="INSERT INTO androidnavtable (id, timeSecond, latitudeDegree, longitudeDegree, route, eta) VALUES(".$id.",".$time.",".$lat.",".$lon.",".$polyline.",".$eta.")";
    print("lat " + $lat);
    echo "lon " + $lon;
    print("\n");
    $query="INSERT INTO androidnavtable (id, timeSecond, latitudeDegree, longitudeDegree, route, eta, flightid) VALUES(".$id.",".$time.",".$lat.",".$lon.",".$polyline.",".$eta.",'test')";

    print($query); # check this if something breaks

	$q=mysql_query($query);
	if (!$q) {
    	die('Invalid query: ' . mysql_error());
	}

	#$query = "SELECT * FROM androidnavtable limit 1";
	#$q=mysql_query($query);
	#while($e=mysql_fetch_assoc($q))
    #	$output[]=$e;

	#print(json_encode($output));
	mysql_close();

?>


37.50611,-122.33685|37.50696,-122.33821|37.50944,-122.34229|37.51036,-122.34357|37.51181,-122.34533|37.51772,-122.3521|37.51931,-122.35353|37.51957,-122.35373|37.51985,-122.35394|37.51999,-122.35393|37.52008,-122.35395|37.52067,-122.35425|37.52205,-122.35484|37.52275,-122.35517|37.52313,-122.35533|37.52311,-122.35621|37.52309,-122.35689|37.52308,-122.357|37.52284,-122.35691|37.52233,-122.35671|37.5222,-122.35665|37.52221,-122.35658|37.52223,-122.3564|37.5222,-122.35621|37.522,-122.35591|37.52124,-122.35543|37.5205,-122.35495|37.52046,-122.3548|37.52027,-122.35469|37.51953,-122.35424|37.51858,-122.35353|37.51787,-122.35291|37.5166,-122.35161|37.51336,-122.34813|37.51231,-122.34694|37.51114,-122.34545|37.5099,-122.34365|37.50687,-122.33869|37.50447,-122.33486|37.50204,-122.33135|37.50152,-122.33041|37.50113,-122.32949|37.5008,-122.32852|37.50048,-122.32705|37.50031,-122.32505|37.50029,-122.32264|37.50011,-122.32097|37.4997,-122.31913|37.4992,-122.31772|37.4981,-122.31562|37.49669,-122.31302|37.49582,-122.31086|37.49523,-122.30876|37.49437,-122.30521|37.49389,-122.30388|37.49326,-122.30265|37.49261,-122.30167|37.49149,-122.30045|37.49075,-122.29984|37.49009,-122.29944|37.48943,-122.2991|37.48843,-122.29875|37.48702,-122.29851|37.4858,-122.29857|37.48302,-122.29901|37.47947,-122.2996|37.47872,-122.29966|37.47786,-122.29961|37.47671,-122.29937|37.47549,-122.29888|37.47463,-122.29837|37.47361,-122.29753|37.47138,-122.29516|37.46988,-122.2936|37.46933,-122.29312|37.46869,-122.29263|37.46779,-122.29207|37.46681,-122.29161|37.46589,-122.2913|37.46452,-122.29102|37.462,-122.2909|37.46072,-122.29076|37.45986,-122.29052|37.45887,-122.29008|37.45835,-122.28978|37.45767,-122.28929|37.45662,-122.28833|37.45588,-122.28739|37.45454,-122.28536|37.45197,-122.28144|37.44789,-122.27533|37.44584,-122.27241|37.44515,-122.27127|37.44473,-122.2704|37.44421,-122.26902|37.44374,-122.267|37.44356,-122.26523|37.44357,-122.26371|37.44381,-122.26129|37.44402,-122.25934|37.44404,-122.25825|37.44398,-122.25722|37.4438,-122.25601|37.4435,-122.25482|37.44301,-122.25349|37.44251,-122.25252|37.44174,-122.25137|37.43805,-122.24666|37.4355,-122.24362|37.43199,-122.23944|37.43026,-122.23718|37.42831,-122.23448|37.42488,-122.22992|37.42095,-122.22424|37.41988,-122.22257|37.41942,-122.22154|37.41904,-122.22027|37.41875,-122.21853|37.41834,-122.21578|37.41813,-122.21489|37.4175,-122.21323|37.41713,-122.21257|37.41627,-122.21141|37.4149,-122.20999|37.41413,-122.20911|37.41347,-122.20809|37.41299,-122.20707|37.41234,-122.20512|37.40965,-122.19674|37.40812,-122.19202|37.40759,-122.19087|37.40701,-122.18992|37.40638,-122.18909|37.40572,-122.1884|37.40215,-122.185|37.39636,-122.17912|37.39428,-122.17698|37.39365,-122.17614|37.3931,-122.17517|37.39263,-122.17403|37.39232,-122.17294|37.39215,-122.17192|37.3919,-122.16859|37.3915,-122.16697|37.39083,-122.1656|37.38984,-122.16396|37.3892,-122.16246|37.38886,-122.16107|37.38827,-122.15722|37.38778,-122.1557|37.38743,-122.15502|37.38694,-122.15428|37.38627,-122.15354|37.38553,-122.15295|37.38505,-122.15268|37.3842,-122.15234|37.38051,-122.15151|37.37956,-122.15117|37.37863,-122.15062|37.37777,-122.1499|37.37643,-122.14843|37.37415,-122.14584|37.37325,-122.14492|37.37094,-122.14283|37.36921,-122.14125|37.36845,-122.1404|37.36777,-122.13941|37.36718,-122.1383|37.36671,-122.13708|37.36612,-122.13514|37.36517,-122.13197|37.36482,-122.13056|37.36447,-122.1263|37.36434,-122.12534|37.3641,-122.12442|37.36379,-122.12352|37.36326,-122.12248|37.36236,-122.12128|37.36181,-122.12073|37.36125,-122.12031|37.3609,-122.1201|37.35795,-122.11821|37.35708,-122.11738|37.35647,-122.11657|37.35562,-122.11502|37.3552,-122.11381|37.35416,-122.10988|37.35346,-122.10835|37.3529,-122.10747|37.35195,-122.10637|37.3502,-122.10499|37.34901,-122.10404|37.34835,-122.10327|37.34783,-122.10249|37.34747,-122.1018|37.3452,-122.09647|37.34459,-122.09534|37.34399,-122.09452|37.34191,-122.09207|37.34154,-122.09153|37.34064,-122.0897|37.33921,-122.08701|37.3376,-122.08423|37.33671,-122.08291|37.33485,-122.08025|37.33418,-122.07903|37.33374,-122.07784|37.33347,-122.07661|37.33332,-122.07537|37.33334,-122.07425|37.33352,-122.07295|37.33379,-122.07155|37.33422,-122.06882|37.33425,-122.06828|37.33413,-122.06624|37.33393,-122.06526|37.33295,-122.06216|37.33232,-122.06007|37.33217,-122.0591|37.33211,-122.05735|37.3322,-122.05649|37.33274,-122.05376|37.33361,-122.0496|37.33402,-122.04735|37.33414,-122.04607|37.33422,-122.04162|37.33427,-122.03245|37.33429,-122.02539|37.3342,-122.0233|37.33378,-122.02128|37.33361,-122.02073|37.33295,-122.01916|37.33051,-122.01438|37.32627,-122.00624|37.32446,-122.00275|37.32293,-121.99983|37.32068,-121.99549|37.31923,-121.99271|37.31874,-121.99161|37.31852,-121.991|37.31816,-121.98955|37.318,-121.9884|37.31798,-121.98442|37.31794,-121.97957|37.31775,-121.97726|37.31727,-121.97557|37.31684,-121.97423|37.31653,-121.97313|37.31634,-121.97212|37.3162,-121.97084|37.31626,-121.96746|37.31638,-121.96415|37.3163,-121.95846|37.31641,-121.95594|37.31663,-121.95339|37.3167,-121.95051|37.3167,-121.94916|37.31671,-121.94751|37.31665,-121.94746|37.31664,-121.94627|37.31672,-121.94325|37.31706,-121.94199|37.31717,-121.94175|37.31765,-121.941|37.3181,-121.94055|37.31847,-121.94028|37.31878,-121.94012|37.31937,-121.93993|37.31996,-121.93989|37.32059,-121.94|37.32264,-121.94042|37.32287,-121.94052|37.32306,-121.94054|37.32328,-121.94056|37.32657,-121.94072|37.3276,-121.94073|37.32925,-121.94071|37.32981,-121.94061|37.33027,-121.94045|37.33097,-121.9401|37.33167,-121.93963|37.33259,-121.93868|37.33371,-121.93721|37.33439,-121.9363|37.33529,-121.93514|37.33681,-121.93317|37.33915,-121.9303|37.33998,-121.92924|37.34255,-121.92589|37.34279,-121.92565|37.34446,-121.92406|37.34584,-121.9222|37.34623,-121.92166|37.34796,-121.91922|37.34797,-121.91906|37.34797,-121.91905|37.34813,-121.91883|37.34846,-121.91831|37.34892,-121.91755|37.34908,-121.91711|37.34906,-121.91643|37.34894,-121.91612|37.34864,-121.91582|37.34841,-121.9157|37.34813,-121.91567|37.34788,-121.91574|37.34763,-121.91594|37.34743,-121.91618|37.34829,-121.91731|37.34873,-121.91786|37.35028,-121.91985|37.35083,-121.9206|37.35114,-121.92122|37.35188,-121.92266|37.3527,-121.92443|37.35395,-121.92709|37.35411,-121.92725|37.35473,-121.92848|37.35557,-121.9302|37.35599,-121.93116|37.35652,-121.93222|37.35681,-121.93319|37.35686,-121.93411|37.35704,-121.93433|37.35713,-121.93438|37.35723,-121.9344|37.35853,-121.93321|37.35858,-121.93316|37.35862,-121.93314|37.35871,-121.93321|37.3618,-121.93657|37.36265,-121.93534|37.36065,-121.93314|


37.068030,-121.213320|37.083850,-121.191980|37.089030,-121.158860|37.100740,-121.122650|37.080730,-121.091530|37.056700,-120.987510|37.022980,-120.937370|36.920600,-120.830740|36.843800,-120.769680|36.609730,-120.592750|36.506090,-120.460080|36.329260,-120.299220|36.177850,-120.195750|36.049790,-120.057560|35.867340,-119.845130|35.630150,-119.663810|35.498440,-119.533420|35.294700,-119.254190|35.040670,-118.980680|34.937510,-118.930710|34.915550,-118.924750|34.895180,-118.919750|34.864520,-118.882020|34.813320,-118.884670|34.791490,-118.834200|34.759800,-118.796430|34.709020,-118.796740|34.672040,-118.768060|34.642460,-118.750380|34.611720,-118.712730|34.575870,-118.699500|34.537990,-118.647830|34.500720,-118.627100|34.462130,-118.615390|34.428880,-118.586440|34.365870,-118.557060|34.343020,-118.529770|34.325650,-118.503910|34.293030,-118.469840|34.247210,-118.472770|34.170540,-118.467790|34.144550,-118.471310|34.118220,-118.481770|34.080280,-118.473040|34.028660,-118.431580|33.975790,-118.389560|33.963480,-118.396180|33.946710,-118.399650|33.944230,-118.408260
